{
  "name": "C++ DevContainer",
  "image": "cpp-dev:latest",

  // Build image before starting container
  "initializeCommand": "bash ${localWorkspaceFolder}/scripts/docker/build_image.sh",

  // Pass host UID/GID to container for runtime remapping
  "containerEnv": {
    "HOST_UID": "${localEnv:UID}",
    "HOST_GID": "${localEnv:GID}"
  },

  // Start container as root to allow entrypoint to remap UID/GID
  "containerUser": "root",
  // VS Code will connect as ubuntu user (with remapped UID/GID)
  "remoteUser": "ubuntu",

  // IMPORTANT: Prevent VS Code from creating a derived "vsc-...-uid" image
  // We handle UID/GID remapping at runtime via our ENTRYPOINT script
  "updateRemoteUserUID": false,

  "customizations": {
    "vscode": {
      "settings": {
        "terminal.integrated.shell.linux": "bash",
        "editor.formatOnSave": true,
        "C_Cpp.clang_format_style": "file",
        "C_Cpp.default.cppStandard": "c++17"
      },
      "extensions": [
        "ms-vscode.cpptools",
        "ms-vscode.cmake-tools"
      ]
    }
  },

  "postCreateCommand": "pre-commit install --hook-type pre-push",
  "postStartCommand": "bash",
  // Clean container name and setup
  "runArgs": [
    "--rm",
    "--hostname", "cpp-devcontainer",
    "--name", "cpp-dev-${localEnv:USER}",
    "--env", "DISPLAY=${localEnv:DISPLAY}",
    "--volume", "/tmp/.X11-unix:/tmp/.X11-unix",
    "--gpus", "all"
    // TODO: Analyze if needed
    // "--cap-add=SYS_PTRACE",
    // "--security-opt", "seccomp=unconfined"
  ]
}
